<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>NAIF VIP â€¢ Signals</title>
<meta name="color-scheme" content="dark"/>
<style>
  :root{--blue:#38BDF8;--glass:rgba(255,255,255,.08);--glassb:rgba(255,255,255,.12);--bg:#0b1220}
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:#fff;font-family:Cairo,Segoe UI,Arial;user-select:none;
            -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;touch-action:manipulation}
  #candlesCanvas{position:fixed;inset:0;z-index:-1;opacity:.23;filter:blur(.4px)}
  .top-center{position:fixed;top:12px;left:50%;transform:translateX(-50%);z-index:25;display:flex;flex-direction:column;align-items:center;gap:8px}
  .naif-anim{width:80px;height:80px;border-radius:18px;display:grid;place-items:center;
    background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.12),rgba(56,189,248,.25) 60%,rgba(11,18,32,.9));
    border:1px solid var(--glassb);backdrop-filter:blur(10px);
    box-shadow:0 10px 24px rgba(0,0,0,.35),inset 0 0 22px rgba(56,189,248,.35);animation:pulse 3s ease-in-out infinite}
  .naif-anim span{font-weight:900;font-size:18px;letter-spacing:1px;color:var(--blue);
    text-shadow:0 0 18px rgba(56,189,248,.55);animation:glow 2.2s ease-in-out infinite alternate}
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.04)}100%{transform:scale(1)}}
  @keyframes glow{from{filter:drop-shadow(0 0 6px rgba(56,189,248,.35))}to{filter:drop-shadow(0 0 16px rgba(56,189,248,.75))}}
  .floating-clock{position:fixed;left:12px;top:12px;background:rgba(255,255,255,.05);border:1px solid var(--glassb);
    padding:10px 14px;border-radius:14px;backdrop-filter:blur(12px);z-index:9999}
  .container{max-width:980px;margin:120px auto 90px;padding:0 16px}
  .glass-card{background:var(--glass);border:1px solid var(--glassb);border-radius:24px;padding:24px 18px;margin:14px 0;backdrop-filter:blur(18px)}
  input[type=password],select{width:100%;padding:14px 16px;border-radius:14px;border:1px solid rgba(255,255,255,.2);
    background:rgba(255,255,255,.08);color:#fff;margin:8px 0 10px;font-size:16px}
  select#pairSelect,select#pairSelect *{filter:none!important;opacity:1!important;color:#fff}
  select#pairSelect{background:rgba(255,255,255,.10)}
  option,optgroup{background:#0b1220;color:#fff}
  .btn{border:none;color:#fff;cursor:pointer;padding:14px 16px;border-radius:14px;font-weight:700;font-size:16px}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .btn-primary{background:linear-gradient(135deg,#3b82f6,#2563eb)}
  .btn-green{background:linear-gradient(135deg,#11998e,#38ef7d)}
  .btn-red{background:linear-gradient(135deg,#fc4a1a,#f7b733)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row>.btn{flex:1 0 220px}
  .status-box{margin:10px 0;padding:12px 14px;border-radius:12px;font-weight:700;border:1px solid transparent;white-space:pre-line}
  .ok{color:#9CFFCB;background:rgba(56,239,125,.12);border-color:rgba(56,239,125,.25)}
  .bad{color:#ffb3b3;background:rgba(255,107,107,.12);border-color:rgba(255,107,107,.25)}
  .hint{opacity:.8;font-size:.9rem}
  .loading-overlay{position:fixed;inset:0;background:rgba(13,25,43,.9);display:none;justify-content:center;align-items:center;z-index:1000}
  .loading-spinner{width:50px;height:50px;border:4px solid rgba(255,255,255,.1);border-left:4px solid #667eea;border-radius:50%;animation:spin 1s linear infinite}
  @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  footer{position:fixed;left:50%;transform:translateX(-50%);bottom:10px;text-align:center;opacity:.9}
  .timers{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .chip{padding:8px 12px;border:1px solid rgba(255,255,255,.2);border-radius:12px;background:rgba(255,255,255,.06);font-weight:700}
  #mainContainer h1{text-align:center}
  @media (max-width:520px){.container{margin-top:110px}.naif-anim{width:64px;height:64px}}
</style>
</head>
<body>
<canvas id="candlesCanvas"></canvas>
<div class="top-center"><div class="naif-anim"><span>NAIF</span></div></div>
<div class="floating-clock"><div id="clock">--:--:--</div><div>UTC+3 â€¢ Asia/Riyadh</div></div>

<div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div></div>

<div class="container">
  <div id="passwordBox" class="glass-card">
    <h1>ğŸ” Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
    <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
    <input id="passwordInput" type="password" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„ Ù‡Ù†Ø§" autocomplete="off"/>
    <div class="row">
      <button id="loginBtn" class="btn btn-primary" onclick="checkPassword()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <button id="musicBtn" class="btn btn-green" onclick="toggleMusic()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ğŸ¼</button>
    </div>
    <div id="loginMsg" class="status-box" style="display:none"></div>
    <div class="hint">âš ï¸ ÙƒÙ„ Ø¶ØºØ·Ø© Ù…ÙØ³Ø¬Ù‘ÙÙ„Ø© Ù„Ù„Ø£Ù…Ø§Ù†</div>
  </div>

  <div id="mainContainer" class="glass-card" style="display:none">
    <h1>POCKET OPTION BOT VIP</h1>
    <div class="timers">
      <div id="expireBox" class="chip">â³ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: --:--:--</div>
      <div id="dayBox" class="chip">ğŸ—“ï¸ Ø§Ù„ÙŠÙˆÙ…: --:--:--</div>
      <div id="tradeBox" class="chip">ğŸ¯ Ø§Ù„ØµÙÙ‚Ø©: â€”</div>
    </div>
    <div style="display:flex;justify-content:center;margin-top:8px">
      <button id="logoutBtn" class="btn btn-red" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <div id="signalsCard" class="glass-card" style="display:none">
    <label>Ø§Ø®ØªØ± Ø§Ù„Ø²ÙˆØ¬:</label>
    <select id="pairSelect">
      <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ø²ÙˆØ¬</option>
      <optgroup label="Ø£Ø²ÙˆØ§Ø¬ OTC (Ø§ØµØ·Ù†Ø§Ø¹ÙŠØ©)">
        <option data-otc="1" value="BHD/CNY">ğŸ‡§ğŸ‡­ BHD/CNY ğŸ‡¨ğŸ‡³</option>
        <option data-otc="1" value="USD/EGP">ğŸ‡ºğŸ‡¸ USD/EGP ğŸ‡ªğŸ‡¬</option>
        <option data-otc="1" value="USD/RUB">ğŸ‡ºğŸ‡¸ USD/RUB ğŸ‡·ğŸ‡º</option>
        <option data-otc="1" value="USD/BRL">ğŸ‡ºğŸ‡¸ USD/BRL ğŸ‡§ğŸ‡·</option>
        <option data-otc="1" value="AED/CNY">ğŸ‡¦ğŸ‡ª AED/CNY ğŸ‡¨ğŸ‡³</option>
        <option data-otc="1" value="SAR/CNY">ğŸ‡¸ğŸ‡¦ SAR/CNY ğŸ‡¨ğŸ‡³</option>
        <option data-otc="1" value="QAR/CNY">ğŸ‡¶ğŸ‡¦ QAR/CNY ğŸ‡¨ğŸ‡³</option>
        <option data-otc="1" value="USD/MXN">ğŸ‡ºğŸ‡¸ USD/MXN ğŸ‡²ğŸ‡½</option>
        <option data-otc="1" value="CAD/JPY">ğŸ‡¨ğŸ‡¦ CAD/JPY ğŸ‡¯ğŸ‡µ</option>
        <option data-otc="1" value="AUD/JPY">ğŸ‡¦ğŸ‡º AUD/JPY ğŸ‡¯ğŸ‡µ</option>
        <option data-otc="1" value="NZD/JPY">ğŸ‡³ğŸ‡¿ NZD/JPY ğŸ‡¯ğŸ‡µ</option>
        <option data-otc="1" value="EUR/HUF">ğŸ‡ªğŸ‡º EUR/HUF ğŸ‡­ğŸ‡º</option>
        <option data-otc="1" value="EUR/TRY">ğŸ‡ªğŸ‡º EUR/TRY ğŸ‡¹ğŸ‡·</option>
      </optgroup>
      <optgroup label="Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ">
        <option value="EUR/USD">ğŸ‡ªğŸ‡º EUR/USD ğŸ‡ºğŸ‡¸</option>
        <option value="GBP/USD">ğŸ‡¬ğŸ‡§ GBP/USD ğŸ‡ºğŸ‡¸</option>
        <option value="USD/JPY">ğŸ‡ºğŸ‡¸ USD/JPY ğŸ‡¯ğŸ‡µ</option>
        <option value="USD/CHF">ğŸ‡ºğŸ‡¸ USD/CHF ğŸ‡¨ğŸ‡­</option>
        <option value="USD/CAD">ğŸ‡ºğŸ‡¸ USD/CAD ğŸ‡¨ğŸ‡¦</option>
        <option value="AUD/USD">ğŸ‡¦ğŸ‡º AUD/USD ğŸ‡ºğŸ‡¸</option>
        <option value="NZD/USD">ğŸ‡³ğŸ‡¿ NZD/USD ğŸ‡ºğŸ‡¸</option>
        <option value="EUR/GBP">ğŸ‡ªğŸ‡º EUR/GBP ğŸ‡¬ğŸ‡§</option>
        <option value="GBP/JPY">ğŸ‡¬ğŸ‡§ GBP/JPY ğŸ‡¯ğŸ‡µ</option>
        <option value="EUR/JPY">ğŸ‡ªğŸ‡º EUR/JPY ğŸ‡¯ğŸ‡µ</option>
        <option value="XAU/USD">ğŸ¥‡ XAU/USD ğŸ‡ºğŸ‡¸</option>
        <option value="BTC/USD">â‚¿ BTC/USD ğŸ‡ºğŸ‡¸</option>
      </optgroup>
    </select>

    <div class="row" style="margin-top:6px">
      <label style="width:100%">Ù…Ø¯Ø© Ø§Ù„ØµÙÙ‚Ø©:</label>
      <select id="tfSelect">
        <option value="1">1 Ø¯Ù‚ÙŠÙ‚Ø©</option>
        <option value="5" selected>5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
        <option value="15">15 Ø¯Ù‚ÙŠÙ‚Ø©</option>
      </select>
    </div>

    <div class="row">
      <button id="analyzeBtn" class="btn btn-green" onclick="analyze()">ğŸ” ØªØ­Ù„ÙŠÙ„</button>
    </div>
    <div class="glass-card" style="margin-top:12px"><div class="status-box" id="result" style="margin:0">â€”</div></div>
  </div>
</div>

<footer>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ù…Ø·ÙˆØ± Â© <b>@najran2015</b></footer>

<script>
/* ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù‡Ø§Ø¯Ø¦ ====== */
let AC=null, master=null, musicIv=null, musicOn=false;
function ensureAC(){
  if(!AC){ const C=window.AudioContext||window.webkitAudioContext; AC=new C(); master=AC.createGain(); master.gain.value=0.06; master.connect(AC.destination); }
  if(AC.state==='suspended'){ AC.resume?.(); }
}
['click','touchend','pointerup'].forEach(ev=>document.addEventListener(ev,e=>{ if(e.target.closest('button')) clickFx(); ensureAC(); },true));
function clickFx(){ try{ ensureAC(); const o=AC.createOscillator(), g=AC.createGain(); o.type='triangle'; o.frequency.value=880; o.connect(g); g.connect(master); const t=AC.currentTime; g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.12,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+0.08); o.start(t); o.stop(t+0.12);}catch{} }
function successFx(){ try{ ensureAC(); [660,990,1318].forEach((f,i)=>{ const o=AC.createOscillator(), g=AC.createGain(); o.type='sine'; o.frequency.value=f; o.connect(g); g.connect(master); const t=AC.currentTime+i*0.12; g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.18,t+0.02); g.gain.exponentialRampToValueAtTime(0.0001,t+0.18); o.start(t); o.stop(t+0.22); }); }catch{} }
function errorFx(){ try{ ensureAC(); const o=AC.createOscillator(), g=AC.createGain(); o.type='sawtooth'; o.frequency.value=140; o.connect(g); g.connect(master); const t=AC.currentTime; g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.18,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+0.25); o.start(t); o.stop(t+0.28);}catch{} }
function startMusic(){ ensureAC(); musicOn=true; const notes=[261.63,329.63,392,440,493.88,523.25]; if(musicIv) clearInterval(musicIv);
  musicIv=setInterval(()=>{ notes.forEach((f,i)=>{ const o=AC.createOscillator(), g=AC.createGain(); o.type='sine'; o.frequency.value=f; o.connect(g); g.connect(master); const t=AC.currentTime+i*0.18; g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.12,t+0.03); g.gain.exponentialRampToValueAtTime(0.0001,t+0.5); o.start(t); o.stop(t+0.52); }); },1200);
}
function stopMusic(){ musicOn=false; if(musicIv) clearInterval(musicIv); }
function toggleMusic(){ musicOn?stopMusic():startMusic(); const b=document.getElementById('musicBtn'); if(b) b.textContent = musicOn?'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ğŸ¼':'ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ğŸ¼'; }

/* ====== Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© ====== */
function showLoading(on){ document.getElementById('loadingOverlay').style.display = on?'flex':'none'; }
function showMsg(html,c='ok'){ const box=document.getElementById('loginMsg'); box.style.display='block'; box.className='status-box '+c; box.innerHTML=html; }
function setBtn(on){ const btn=document.getElementById('loginBtn'); if(!btn) return; btn.disabled=!on; btn.textContent = on?'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„':'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚â€¦'; }
async function sha256Str(s){ const enc=new TextEncoder().encode(s); const buf=await crypto.subtle.digest('SHA-256',enc); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
function asForm(d){ const p=new URLSearchParams(); Object.entries(d).forEach(([k,v])=>{ if(v!==undefined&&v!==null) p.append(k,String(v)); }); return p; }
function looksHtml(t){ const s=(t||'').trim(); return s.startsWith('<')||s.includes('<!DOCTYPE html>')||s.includes('<html'); }

/* ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª KeyAuth + ØªØ¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ø§Øª ====== */
const APP={ name:'BOTY', ownerid:'5RvEKZwAIM', ver:'1.0' };
let CURRENT_API_BASE=null;
const API_ALIASES={ win:'https://keyauth.win/api/1.3/', cc:'https://keyauth.cc/api/1.3/', prod:'https://prod.keyauth.com/api/1.3/' };

/* Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ† Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§Ø´: #api=https://.. Ø£Ùˆ #api=win */
(function applyApiFromHash(){
  try{
    const h=(location.hash||'').slice(1);
    if(h.startsWith('api=')){
      const v=decodeURIComponent(h.split('=').slice(1).join('=').trim());
      const url = API_ALIASES[v] || (v.startsWith('http')? v : null);
      if(url){ localStorage.setItem('naif_api_base', url); }
    }
  }catch{}
})();

async function apiPost(base, data, timeoutMs=12000){
  const ctrl=new AbortController(); const id=setTimeout(()=>ctrl.abort(), timeoutMs);
  try{
    const r=await fetch(base,{ method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded','Accept':'application/json,text/plain,*/*'}, body:asForm(data), mode:'cors', credentials:'omit', signal:ctrl.signal });
    const text=await r.text();
    if(!r.ok) throw new Error('HTTP '+r.status);
    if(looksHtml(text)) throw new Error('HTML');
    let j=null; try{ j=JSON.parse(text); }catch{ throw new Error('Not JSON'); }
    return j;
  }finally{ clearTimeout(id); }
}

/* ØªÙ‡ÙŠØ¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªØ¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… + Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© */
async function keyauthInitMulti(){
  const saved = localStorage.getItem('naif_api_base');
  const candidates = [saved, API_ALIASES.win, API_ALIASES.cc, API_ALIASES.prod].filter(Boolean);
  let lastErr=null;
  for(const base of candidates){
    try{
      const hash = await sha256Str('naif-web-'+APP.ver);
      const j = await apiPost(base,{type:'init',name:APP.name,ownerid:APP.ownerid,ver:APP.ver,hash});
      if(j && j.success){ CURRENT_API_BASE=base; if(saved!==base) localStorage.setItem('naif_api_base', base); return j.sessionid; }
      lastErr = new Error(j ? (j.message||'init failed') : 'init failed');
    }catch(e){ lastErr=e; }
  }
  throw lastErr || new Error('No API endpoint reachable');
}

async function keyauthLicense(sessionid, key){
  const payload={ type:'license', key, sessionid, name:APP.name, ownerid:APP.ownerid };
  let j = await apiPost(CURRENT_API_BASE, payload).catch(e=>{ throw e; });
  /* Ù„Ø§ Ù†ÙØ±Ø¶ HWID Ø¥Ù„Ø§ Ù„Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø·Ù„Ø¨Ù‡ */
  if(!j.success && /hwid/i.test(j.message||'')){
    try{
      const hw=await sha256Str(navigator.userAgent+'|'+navigator.platform);
      j=await apiPost(CURRENT_API_BASE, {...payload, hwid:hw});
    }catch(e){}
  }
  return j;
}

function logout(){ localStorage.removeItem('naif_active'); location.reload(); }
(function autoLogin(){
  try{
    const saved=JSON.parse(localStorage.getItem('naif_active')||'null');
    if(saved && (!saved.exp || (saved.exp*1000>Date.now()))){ showMain(saved.exp); }
  }catch{}
})();

/* ====== ØªØ·Ø¨ÙŠØ¹ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ====== */
function normalizeExpiryTs(exp){
  if(!exp) return null; let n=Number(exp);
  if(!isFinite(n)||n<=0) return null; /* Ø«ÙˆØ§Ù†ÙŠ */ if(n>1e12) n=Math.floor(n/1000); /* Ù„Ùˆ Ø¬Ø§Ø¡ Ù…ØªØ¨Ù‚Ù‘ÙŠ */ if(n<1e9) n=Math.floor(Date.now()/1000)+n;
  return Math.floor(n);
}

/* ====== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ====== */
let authBusy=false;
async function checkPassword(){
  if(authBusy) return;
  const code=document.getElementById('passwordInput').value.trim();
  if(!code){ showMsg('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„ Ø£ÙˆÙ„Ù‹Ø§','bad'); errorFx(); return; }
  authBusy=true; setBtn(false); showLoading(true);
  try{
    showMsg('âŒ› Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„â€¦','ok');
    let sid = await keyauthInitMulti();
    let res = await keyauthLicense(sid, code);
    if(!res.success && /session not found|only.*opened/i.test((res.message||'').toLowerCase())){
      sid = await keyauthInitMulti();
      res = await keyauthLicense(sid, code);
    }
    if(res.success){
      successFx();
      let exp=null;
      const paths=[['info','expires'],['info','expiry'],['info','expiration'],['expiry'],['expires'],['subscriptions','0','expiry'],['info','subscriptions','0','expiry'],['sub','expiry']];
      for(const p of paths){ let v=res; for(const k of p){ v=(v||{})[k]; } if(v){ exp=Number(v); break; } }
      const expNorm=normalizeExpiryTs(exp);
      localStorage.setItem('naif_active', JSON.stringify({code:code,sid:sid,exp:expNorm||null}));
      document.getElementById('loginMsg').style.display='none';
      showMain(expNorm||null);
    }else{
      throw new Error(res.message||'ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚');
    }
  }catch(err){
    errorFx();
    const msg = (String(err.message||err).includes('Failed to fetch')||String(err.message||err).includes('abort'))?
      'âš ï¸ ØªØ¹Ø°Ù‘Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù… KeyAuth (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø­Ø¬Ø¨/Ø´Ø¨ÙƒØ©/CORS).' :
      String(err.message||'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚');
    showMsg('âŒ '+msg,'bad');
  }finally{ authBusy=false; setBtn(true); showLoading(false); }
}

/* ====== Ù…Ø¤Ø´Ø±Ø§Øª ÙˆØªØ­Ù„ÙŠÙ„ + OTC/Real ====== */
function toNum(x){const n=Number(x);return isFinite(n)?n:0;}
function parseSeries(values){ return values.map(v=>({t:new Date(v.datetime.replace(' ','T')+'Z').getTime(),o:toNum(v.open),h:toNum(v.high),l:toNum(v.low),c:toNum(v.close),v:toNum(v.volume)})).reverse(); }
function SMA(a,p,sel=x=>x.c){const o=[];let s=0;for(let i=0;i<a.length;i++){s+=sel(a[i]);if(i>=p)s-=sel(a[i-p]);o.push(i>=p-1?(s/p):NaN);}return o;}
function EMA(src,p,sel=x=>x.c){const a=Array.isArray(src)?src:src.map(x=>({c:x}));const o=[];const k=2/(p+1);let e=0;for(let i=0;i<a.length;i++){const v=sel(a[i]);e=i? v*k+e*(1-k):v;o.push(e);}return o;}
function RSI(a,p=14){const o=[];let g=0,l=0;for(let i=1;i<a.length;i++){const ch=a[i].c-a[i-1].c,gg=Math.max(0,ch),ll=Math.max(0,-ch);if(i<=p){g+=gg;l+=ll;if(i===p){const rs=(g/p)/((l/p)||1e-9);o.push(100-(100/(1+rs)));}else o.push(NaN);}else{g=(g*(p-1)+gg)/p;l=(l*(p-1)+ll)/p;const rs=(g)/((l)||1e-9);o.push(100-(100/(1+rs)));}}o.unshift(NaN);return o;}
function MACD(a,ft=12,sl=26,sg=9){const ef=EMA(a,ft),es=EMA(a,sl);const m=ef.map((v,i)=>v-es[i]);const s=EMA(m.map((v)=>({c:v})),sg,x=>x.c);const h=m.map((v,i)=>v-s[i]);return{macd:m,sig:s,hist:h};}
function STOK(a,p=14,d=3){const k=[];for(let i=0;i<a.length;i++){if(i<p-1){k.push(NaN);continue;}let hi=-1e9,lo=1e9;for(let j=i-p+1;j<=i;j++){hi=Math.max(hi,a[j].h);lo=Math.min(lo,a[j].l);}k.push(((a[i].c-lo)/((hi-lo)||1e-9))*100);}const dl=SMA(k.map(c=>({c})),d,x=>x.c);return{k, d:dl};}
function BBANDS(a,p=20,m=2){const s=SMA(a,p);const u=[],l=[];for(let i=0;i<a.length;i++){if(i<p-1){u.push(NaN);l.push(NaN);continue;}let mean=s[i],s2=0;for(let j=i-p+1;j<=i;j++){const d=a[j].c-mean;s2+=d*d;}const sd=Math.sqrt(s2/p);u.push(mean+m*sd);l.push(mean-m*sd);}return{upper:u,lower:l,basis:s};}
function TR(a,b){return Math.max(a.h-a.l,Math.abs(a.h-b.c),Math.abs(a.l-b.c));}
function ATR(a,p=14){const o=[NaN];for(let i=1;i<a.length;i++)o.push(TR(a[i],a[i-1]));return EMA(o,p);}
function ADX(a,p=14){const dmp=[NaN],dmn=[NaN],trs=[NaN];for(let i=1;i<a.length;i++){const up=a[i].h-a[i-1].h,dn=a[i-1].l-a[i].l;dmp.push(up>dn&&up>0?up:0);dmn.push(dn>up&&dn>0?dn:0);trs.push(TR(a[i],a[i-1]));}const smp=EMA(dmp,p),smn=EMA(dmn,p),str=EMA(trs,p);const dip=smp.map((v,i)=>100*((v||0)/((str[i]||1e-9))));const din=smn.map((v,i)=>100*((v||0)/((str[i]||1e-9))));const dx=dip.map((v,i)=>100*(Math.abs((v-din[i]))/((v+din[i])||1e-9)));const adx=EMA(dx,p);return{dip,din,adx};}
function CCI(a,p=20){const tp=a.map(x=>(x.h+x.l+x.c)/3);const s=SMA(tp.map(c=>({c})),p,x=>x.c);const o=[];for(let i=0;i<a.length;i++){if(i<p-1){o.push(NaN);continue;}let md=0;for(let j=i-p+1;j<=i;j++){md+=Math.abs(tp[j]-s[i]);}md/=p;o.push((tp[i]-s[i])/((0.015*md)||1e-9));}return o;}
function WILLR(a,p=14){const o=[];for(let i=0;i<a.length;i++){if(i<p-1){o.push(NaN);continue;}let hi=-1e9,lo=1e9;for(let j=i-p+1;j<=i;j++){hi=Math.max(hi,a[j].h);lo=Math.min(lo,a[j].l);}o.push(-100*((hi-a[i].c)/((hi-lo)||1e-9)));}return o;}
function ROC(a,p=10){const o=[];for(let i=0;i<a.length;i++){if(i<p){o.push(NaN);continue;}o.push(((a[i].c-a[i-p].c)/((a[i-p].c)||1e-9))*100);}return o;}
function AROON(a,p=14){const up=[],dn=[];for(let i=0;i<a.length;i++){if(i<p-1){up.push(NaN);dn.push(NaN);continue;}let hi=-1e9,hiI=i,lo=1e9,loI=i;for(let j=i-p+1;j<=i;j++){if(a[j].h>hi){hi=a[j].h;hiI=j;}if(a[j].l<lo){lo=a[j].l;loI=j;}}up.push(100*((p-(i-hiI))/p));dn.push(100*((p-(i-loI))/p));}return{up,down:dn};}
function PSAR(a,st=0.02,mx=0.2){const o=[NaN];let up=true,af=st,ep=a[0].h,sar=a[0].l;for(let i=1;i<a.length;i++){sar=sar+af*(ep-sar);if(up){if(a[i].l<sar){up=false;sar=ep;ep=a[i].l;af=st;}else{if(a[i].h>ep){ep=a[i].h;af=Math.min(af+st,mx);}}}else{if(a[i].h>sar){up=true;sar=ep;ep=a[i].h;af=st;}else{if(a[i].l<ep){ep=a[i].l;af=Math.min(af+st,mx);}}}o.push(sar);}return o;}
function isBull(b){return b.c>b.o;}function isBear(b){return b.c<b.o;}function body(b){return Math.abs(b.c-b.o);}function upperW(b){return b.h-Math.max(b.c,b.o);}function lowerW(b){return Math.min(b.c,b.o)-b.l;}
function engulfing(p,c){return (isBull(c)&&isBear(p)&&c.c>p.o&&c.o<p.c)||(isBear(c)&&isBull(p)&&c.o>p.c&&c.c<p.o);}
function hammer(b){const bw=body(b),lw=lowerW(b),uw=upperW(b);return lw>bw*2&&uw<bw;}
function shootingStar(b){const bw=body(b),lw=lowerW(b),uw=upperW(b);return uw>bw*2&&lw<bw;}
function doji(b){return body(b)<= (b.h-b.l)*0.1;}
function scoreSignals(a){const N=a.length;if(N<40)return{score:0,dir:'Ù…Ø­Ø§ÙŠØ¯',conf:0};const rsi=RSI(a,14),mac=MACD(a,12,26,9),st=STOK(a,14,3),bb=BBANDS(a,20,2),atr=ATR(a,14),adx=ADX(a,14),cci=CCI(a,20),wr=WILLR(a,14),roc=ROC(a,10),ar=AROON(a,14),ps=PSAR(a),s5=SMA(a,5),s10=SMA(a,10),s20=SMA(a,20),s50=SMA(a,50),s100=SMA(a,100),s200=SMA(a,200),e9=EMA(a,9),e21=EMA(a,21),e26=EMA(a,26),e50=EMA(a,50),e100=EMA(a,100);const i=N-1,c=a[i].c;const v=[];const push=x=>v.push(x);
push(c>s5[i]?1:-1);push(c>s10[i]?1:-1);push(c>s20[i]?1:-1);push(c>s50[i]?1:-1);
push(c>e9[i]?1:-1);push(c>e21[i]?1:-1);push(c>e50[i]?1:-1);
push(s20[i]>s50[i]?1:-1);push(e26[i]?((e26[i]<e50[i])?-1:1):0);
push(s50[i]>s100[i]?1:-1);push(e50[i]>e100[i]?1:-1);push(s100[i]>s200[i]?1:-1);
push(mac.hist[i]>0?1:-1);push(rsi[i]>50?1:-1);push(st.k[i]>st.d[i]?1:-1);
if(rsi[i]<30)push(1);else if(rsi[i]>70)push(-1);
if(st.k[i]<20)push(1);else if(st.k[i]>80)push(-1);
if(c>bb.upper[i])push(-1);else if(c<bb.lower[i])push(1);
if(adx.adx[i]>20){push(1);push(adx.dip[i]>adx.din[i]?1:-1);}
push(cci[i]>0?1:-1);push(wr[i]>-50?1:-1);push(roc[i]>0?1:-1);
push(ar.up[i]>ar.down[i]?1:-1);
if(atr[i]>atr[i-5])push((c>a[i-1].c)?1:-1);
push(((isNaN(ps[i-1])||ps[i-1]<a[i-1].c)&&ps[i]>c)?-1:(ps[i]<c?1:0));
const b0=a[i],b1=a[i-1];if(engulfing(b1,b0))push(isBull(b0)?1:-1);if(hammer(b0))push(1);if(shootingStar(b0))push(-1);if(doji(b0))push(0);
const sum=v.reduce((x,y)=>x+y,0);let dir=sum>0?'Ø´Ø±Ø§Ø¡':(sum<0?'Ø¨ÙŠØ¹':'Ù…Ø­Ø§ÙŠØ¯');const conf=Math.min(100,Math.round((Math.abs(sum)/v.length)*100));return{score:sum,dir,conf};}

/* ====== OTC & TwelveData ====== */
const REAL_SYMBOLS=new Set(['EUR/USD','GBP/USD','USD/JPY','USD/CHF','USD/CAD','AUD/USD','NZD/USD','EUR/GBP','GBP/JPY','EUR/JPY','XAU/USD','BTC/USD']);
function seedFrom(str){let h=2166136261>>>0;for(let i=0;i<str.length;i++){h^=str.charCodeAt(i);h=Math.imul(h,16777619);}return h>>>0;}
function makePRNG(seed){let x=seed||123456789;return function(){x^=x<<13;x^=x>>>17;x^=x<<5;return (x>>>0)/4294967296;};}
function synthSeries(symbol,len=500){const seed=seedFrom(symbol+new Date().toISOString().slice(0,10));const rnd=makePRNG(seed);let base=1+(seed%300)/100;if(/JPY/.test(symbol))base=100+(seed%50);if(/BTC|XAU/.test(symbol))base=1000+(seed%500);const arr=[];let c=base;for(let i=0;i<len;i++){const drift=Math.sin(i/30)*0.06+Math.cos(i/53)*0.04;const step=(rnd()-0.5)*0.15+drift;const o=c;c=Math.max(0.0001,c*(1+step/100));const h=Math.max(o,c)*(1+(rnd()*0.08));const l=Math.min(o,c)*(1-(rnd()*0.08));arr.push({t:Date.now()-(len-i)*60000,o,h,l,c,v:1000+Math.floor(rnd()*200)});}return arr;}
const TD_KEY='6cdf4e70d5a246efa5e23c208de894b5', TD_BASE='https://api.twelvedata.com', CACHE_TTL=180000, MIN_GAP=10000;let lastFetch=0;const inflight=new Map();
function cacheGet(k){try{const o=JSON.parse(localStorage.getItem(k)||'null'); if(o&&Date.now()-o.t<CACHE_TTL)return o.d;}catch{}return null;}
function cacheSet(k,d){try{localStorage.setItem(k,JSON.stringify({t:Date.now(),d}))}catch{}}
async function fetchSeriesReal(symbol,interval='1min',size=200){
  const key=`td_${symbol}_${interval}`;const cached=cacheGet(key);if(cached)return cached;
  const now=Date.now();if(now-lastFetch<MIN_GAP)await new Promise(r=>setTimeout(r,MIN_GAP-(now-lastFetch)));
  if(inflight.has(key))return await inflight.get(key);
  const url=`${TD_BASE}/time_series?symbol=${encodeURIComponent(symbol)}&interval=${interval}&outputsize=${size}&apikey=${TD_KEY}`;
  const p=(async()=>{try{lastFetch=Date.now();const r=await fetch(url);const j=await r.json();if(j&&j.values){const arr=parseSeries(j.values);cacheSet(key,arr);return arr;}if(j&&j.status==='error')throw new Error(j.message||'API error');throw new Error('No data');}finally{inflight.delete(key);}})();
  inflight.set(key,p);return await p;
}

/* ====== ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø¹Ø± ====== */
function fmtPrice(pair,p){if(/JPY\b/.test(pair))return p.toFixed(3);if(/\b(BTC|XAU)\b/.test(pair))return p.toFixed(2);if(p>=100)return p.toFixed(2);if(p>=1)return p.toFixed(4);return p.toFixed(6);}

/* ====== Ø§Ù„ØªÙˆÙ‚ÙŠØªØ§Øª ====== */
let tradeTimer=null;function riyadhNow(){return new Date(new Date().toLocaleString('en-US',{timeZone:'Asia/Riyadh'}));}
function roundUpToM(d,m){const x=new Date(d.getTime());const mm=x.getMinutes();const next=Math.ceil((mm+0.0001)/m)*m;if(next>=60){x.setHours(x.getHours()+1);x.setMinutes(0);}else x.setMinutes(next);x.setSeconds(0);x.setMilliseconds(0);return x;}
function startTradeCountdown(entry,dur){clearInterval(tradeTimer);const box=document.getElementById('tradeBox');function tick(){const now=riyadhNow();if(now<entry){const diff=entry-now;const M=Math.floor(diff/60000),S=Math.floor((diff%60000)/1000);box.textContent=`ğŸ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¹Ø¯: ${String(M).padStart(2,'0')}:${String(S).padStart(2,'0')}`;}else{const end=new Date(entry.getTime()+dur*60000);const diff=end-now;if(diff<=0){box.textContent='âœ… Ø§Ù†ØªÙ‡Øª Ø§Ù„ØµÙÙ‚Ø©';clearInterval(tradeTimer);return;}const M=Math.floor(diff/60000),S=Math.floor((diff%60000)/1000);box.textContent=`â±ï¸ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¨Ø¹Ø¯: ${String(M).padStart(2,'0')}:${String(S).padStart(2,'0')}`;}}tick();tradeTimer=setInterval(tick,1000);}
let dayTimer=null;function startDayCountdown(){clearInterval(dayTimer);const box=document.getElementById('dayBox');function tick(){const now=riyadhNow();const end=new Date(now);end.setHours(23,59,59,999);const diff=end-now;const h=Math.floor(diff/3600000),m=Math.floor((diff%3600000)/60000),s=Math.floor((diff%60000)/1000);box.textContent=`ğŸ—“ï¸ Ø§Ù„ÙŠÙˆÙ…: ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;}tick();dayTimer=setInterval(tick,1000);}

/* ====== ÙƒÙˆÙ„ Ø¯Ø§ÙˆÙ† ====== */
function cooldownFor(tf){return tf==1?3:tf==5?5:0;}
function checkCooldown(pair,tf){const k=`lt_${pair}_${tf}`;const last=Number(localStorage.getItem(k)||0);const cd=cooldownFor(tf)*60000;const now=Date.now();const remain=last+cd-now;return{ok:remain<=0,remainMs:Math.max(0,remain),key:k};}

/* ====== ØªØ­Ù„ÙŠÙ„ ====== */
async function analyze(){
  const sel=document.getElementById('pairSelect'); const pr=sel.value; const opt=sel.options[sel.selectedIndex]; if(!pr){alert('Ø§Ø®ØªØ± Ø²ÙˆØ¬Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹');return;}
  const dur=parseInt(document.getElementById('tfSelect').value,10);
  const cd=checkCooldown(pr,dur); if(!cd.ok){const m=Math.floor(cd.remainMs/60000),s=Math.floor((cd.remainMs%60000)/1000);const r=document.getElementById('result');r.className='status-box bad';r.textContent=`â›” ÙŠØ¬Ø¨ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;errorFx();return;}
  showLoading(true);
  try{
    const isOTC = (opt && (opt.dataset?.otc==='1' || (opt.parentNode&&/OTC/.test(opt.parentNode.label)) || !REAL_SYMBOLS.has(pr)));
    let series = isOTC ? synthSeries(pr,500) : await fetchSeriesReal(pr,'1min',200);
    let {dir,conf}=scoreSignals(series);
    if(isOTC && dir==='Ù…Ø­Ø§ÙŠØ¯'){ const L=series[series.length-1]; dir = L.c>=L.o?'Ø´Ø±Ø§Ø¡':'Ø¨ÙŠØ¹'; conf=Math.max(conf,55); }
    const entry=roundUpToM(riyadhNow(),dur); startTradeCountdown(entry,dur);
    const last=series[series.length-1]; const entryPrice=last?fmtPrice(pr,last.c):'â€”';
    const ft=new Intl.DateTimeFormat('ar-EG',{hour:'2-digit',minute:'2-digit',hour12:false,timeZone:'Asia/Riyadh'});
    const fd=new Intl.DateTimeFormat('ar-EG',{year:'numeric',month:'numeric',day:'numeric',timeZone:'Asia/Riyadh'});
    const ico=dir==='Ø´Ø±Ø§Ø¡'?'ğŸŸ©':'ğŸŸ¥';
    const msg = `${pr}\nğŸ•˜ Ù…Ø¯Ø© Ø§Ù„ØµÙÙ‚Ø© ${dur} Ø¯Ù‚ÙŠÙ‚Ø©\nâºï¸ Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ${ft.format(entry)}\n${ico} ${dir}\n\nğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„: ${entryPrice}\n\nâœ… Ù‚ÙˆØ© Ø§Ù„Ø¥Ø´Ø§Ø±Ø©: ${conf}%\nğŸ“… ${fd.format(riyadhNow())} ğŸ‡¸ğŸ‡¦`;
    const r=document.getElementById('result'); r.className='status-box ok'; r.textContent=msg; successFx();
    localStorage.setItem(cd.key,String(Date.now()));
  }catch(e){
    const r=document.getElementById('result'); r.className='status-box bad'; r.textContent=String(e.message||e); errorFx();
  }finally{ showLoading(false); }
}

/* ====== Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© + Ø§Ù„Ø¹Ø¯Ø§Ø¯ ====== */
let expireTimer=null;
function showMain(expTs){
  document.getElementById('passwordBox').style.display='none';
  document.getElementById('mainContainer').style.display='block';
  document.getElementById('signalsCard').style.display='block';
  startDayCountdown();
  const box=document.getElementById('expireBox'); clearInterval(expireTimer);
  if(!expTs){ box.textContent='ğŸ”“ ØºÙŠØ± Ù…Ù‚ÙŠÙ‘Ø¯ Ø¨ÙˆÙ‚Øª'; return; }
  const exp=normalizeExpiryTs(expTs); const MAX_OK=10*365*24*3600; const diff0=(exp*1 - Math.floor(Date.now()/1000));
  if(!isFinite(diff0)||diff0>MAX_OK||diff0<=0){ box.textContent='ğŸ”“ ØºÙŠØ± Ù…Ù‚ÙŠÙ‘Ø¯ Ø¨ÙˆÙ‚Øª'; return; }
  function tick(){ const d=(exp*1000)-Date.now(); if(d<=0){ clearInterval(expireTimer); box.className='chip'; box.textContent='â›” Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø³ÙŠØ±ÙŠØ§Ù„.'; localStorage.removeItem('naif_active'); return; } const h=Math.floor(d/3600000), m=Math.floor((d%3600000)/60000), s=Math.floor((d%60000)/1000); box.textContent=`â³ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
  tick(); expireTimer=setInterval(tick,1000);
}

/* ====== Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´Ù…ÙˆØ¹ + Ø§Ù„Ø³Ø§Ø¹Ø© + ØªØ¹Ø·ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆÙ‘Ø± ====== */
const canvas=document.getElementById('candlesCanvas'), ctx=canvas.getContext('2d'); let W=0,H=0;
function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; } addEventListener('resize',resize,{passive:true}); resize();
const candles=[]; function spawn(){ const x=W+Math.random()*200,b=8+Math.random()*24,hi=b+(Math.random()*26),lo=b+(Math.random()*26),o=Math.random()*H,c=o+(Math.random()>.5?b:-b); candles.push({x,o,c,hi:Math.max(o,c)+Math.random()*hi,lo:Math.min(o,c)-Math.random()*lo,v:0.8+Math.random()*1.5,w:6+Math.random()*4,col:c>o?'rgba(80,255,170,0.55)':'rgba(255,120,120,0.55)'}); }
for(let i=0;i<70;i++)spawn();
function loop(){ ctx.clearRect(0,0,W,H); for(let i=candles.length-1;i>=0;i--){ const k=candles[i]; k.x-=k.v; ctx.strokeStyle=k.col; ctx.lineWidth=1.25; ctx.beginPath(); ctx.moveTo(k.x,k.hi); ctx.lineTo(k.x,k.lo); ctx.stroke(); const x=k.x-k.w/2,y=Math.min(k.o,k.c),h=Math.abs(k.c-k.o); ctx.fillStyle=k.col; ctx.fillRect(x,y,k.w,Math.max(3,h)); if(k.x<-40){ candles.splice(i,1); spawn(); } } requestAnimationFrame(loop); } loop();
function tickClock(){ const d=new Date(new Date().toLocaleString('en-US',{timeZone:'Asia/Riyadh'})); const hh=String(d.getHours()).padStart(2,'0'), mm=String(d.getMinutes()).padStart(2,'0'), ss=String(d.getSeconds()).padStart(2,'0'); document.getElementById('clock').textContent=`${hh}:${mm}:${ss}`; } setInterval(tickClock,1000); tickClock();
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{ if(e.keyCode===123||(e.ctrlKey&&e.shiftKey&&['I','J','C'].includes(e.key.toUpperCase()))||(e.ctrlKey&&['U','S','P'].includes(e.key.toUpperCase()))){ e.preventDefault(); alert('ğŸš« Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆÙ‘Ø± Ù…Ø¹Ø·Ù„Ø©.'); }});
</script>
</body>
</html>
